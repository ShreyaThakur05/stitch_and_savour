{"ast":null,"code":"import _objectSpread from\"d:/project1/stitch_and_savour/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import cartService from'../services/cartService';import{useAuth}from'./AuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";const CartContext=/*#__PURE__*/createContext();export const useCart=()=>{const context=useContext(CartContext);if(!context){throw new Error('useCart must be used within a CartProvider');}return context;};export const CartProvider=_ref=>{let{children}=_ref;const[cartItems,setCartItems]=useState([]);const navigate=useNavigate();const{user}=useAuth();// Load cart from localStorage on mount\nuseEffect(()=>{const savedCart=localStorage.getItem('stitch_savour_cart');if(savedCart){try{setCartItems(JSON.parse(savedCart));}catch(error){console.error('Error loading cart from localStorage:',error);}}},[]);// Save cart to localStorage and sync to backend whenever it changes\nuseEffect(()=>{localStorage.setItem('stitch_savour_cart',JSON.stringify(cartItems));if(user&&cartItems.length>0){cartService.syncCart(cartItems);}},[cartItems,user]);const addToCart=function(product){let quantity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;let customizations=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};let selectedWeight=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'';// Calculate final price including customizations and weight\nlet finalPrice=product.price;// For food items, calculate price based on weight\nif(product.category==='food'&&selectedWeight){if(product.name==='Homemade Gujiya'){// Special pricing for Gujiya\nif(selectedWeight==='6 pieces')finalPrice=150;else if(selectedWeight==='12 pieces')finalPrice=300;else if(selectedWeight==='24 pieces')finalPrice=600;}else if(product.pricePerKg){// Handle weight-based pricing for other food items\nlet weightValue;if(selectedWeight.includes('kg')){weightValue=parseFloat(selectedWeight.replace(/[^0-9.]/g,''));}else{weightValue=parseFloat(selectedWeight.replace(/[^0-9.]/g,''))/1000;// Convert g to kg\n}finalPrice=Math.round(product.pricePerKg*weightValue);}}// Add customization modifiers\nif(product.customization){product.customization.forEach(option=>{const selectedValue=customizations[option.type];if(selectedValue&&option.priceModifier&&typeof option.priceModifier==='object'){finalPrice+=option.priceModifier[selectedValue]||0;}});}setCartItems(prevItems=>{const existingItemIndex=prevItems.findIndex(item=>(item.id===product.id||item._id===product._id)&&JSON.stringify(item.customizations)===JSON.stringify(customizations)&&item.selectedWeight===selectedWeight);if(existingItemIndex>-1){// Update existing item\nconst updatedItems=[...prevItems];updatedItems[existingItemIndex].quantity+=quantity;return updatedItems;}else{// Add new item\nreturn[...prevItems,_objectSpread(_objectSpread({},product),{},{id:product.id||product._id,quantity,customizations,selectedWeight,finalPrice,cartId:\"\".concat(product.id||product._id,\"_\").concat(Date.now(),\"_\").concat(Math.random())})];}});return true;};const removeFromCart=cartId=>{setCartItems(prevItems=>prevItems.filter(item=>item.cartId!==cartId));};const updateQuantity=(cartId,newQuantity)=>{if(newQuantity<=0){removeFromCart(cartId);return;}setCartItems(prevItems=>prevItems.map(item=>item.cartId===cartId?_objectSpread(_objectSpread({},item),{},{quantity:newQuantity}):item));};const clearCart=async()=>{setCartItems([]);localStorage.removeItem('stitch_savour_cart');if(user){await cartService.clearCart();}};const getCartTotal=()=>{return cartItems.reduce((total,item)=>{const itemPrice=item.finalPrice||item.price;return total+itemPrice*item.quantity;},0);};const getTotalItems=()=>{return cartItems.reduce((total,item)=>total+item.quantity,0);};const getDeliveryTime=()=>{if(cartItems.length===0)return 0;return Math.max(...cartItems.map(item=>item.deliveryTime||2));};const value={cartItems,addToCart,removeFromCart,updateQuantity,clearCart,getCartTotal,getTotalItems,getDeliveryTime};return/*#__PURE__*/_jsx(CartContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useNavigate","cartService","useAuth","jsx","_jsx","CartContext","useCart","context","Error","CartProvider","_ref","children","cartItems","setCartItems","navigate","user","savedCart","localStorage","getItem","JSON","parse","error","console","setItem","stringify","length","syncCart","addToCart","product","quantity","arguments","undefined","customizations","selectedWeight","finalPrice","price","category","name","pricePerKg","weightValue","includes","parseFloat","replace","Math","round","customization","forEach","option","selectedValue","type","priceModifier","prevItems","existingItemIndex","findIndex","item","id","_id","updatedItems","_objectSpread","cartId","concat","Date","now","random","removeFromCart","filter","updateQuantity","newQuantity","map","clearCart","removeItem","getCartTotal","reduce","total","itemPrice","getTotalItems","getDeliveryTime","max","deliveryTime","value","Provider"],"sources":["d:/project1/stitch_and_savour/frontend/src/context/CartContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport cartService from '../services/cartService';\nimport { useAuth } from './AuthContext';\n\nconst CartContext = createContext();\n\nexport const useCart = () => {\n  const context = useContext(CartContext);\n  if (!context) {\n    throw new Error('useCart must be used within a CartProvider');\n  }\n  return context;\n};\n\nexport const CartProvider = ({ children }) => {\n  const [cartItems, setCartItems] = useState([]);\n  const navigate = useNavigate();\n  const { user } = useAuth();\n\n  // Load cart from localStorage on mount\n  useEffect(() => {\n    const savedCart = localStorage.getItem('stitch_savour_cart');\n    if (savedCart) {\n      try {\n        setCartItems(JSON.parse(savedCart));\n      } catch (error) {\n        console.error('Error loading cart from localStorage:', error);\n      }\n    }\n  }, []);\n\n  // Save cart to localStorage and sync to backend whenever it changes\n  useEffect(() => {\n    localStorage.setItem('stitch_savour_cart', JSON.stringify(cartItems));\n    if (user && cartItems.length > 0) {\n      cartService.syncCart(cartItems);\n    }\n  }, [cartItems, user]);\n\n  const addToCart = (product, quantity = 1, customizations = {}, selectedWeight = '') => {\n    // Calculate final price including customizations and weight\n    let finalPrice = product.price;\n    \n    // For food items, calculate price based on weight\n    if (product.category === 'food' && selectedWeight) {\n      if (product.name === 'Homemade Gujiya') {\n        // Special pricing for Gujiya\n        if (selectedWeight === '6 pieces') finalPrice = 150;\n        else if (selectedWeight === '12 pieces') finalPrice = 300;\n        else if (selectedWeight === '24 pieces') finalPrice = 600;\n      } else if (product.pricePerKg) {\n        // Handle weight-based pricing for other food items\n        let weightValue;\n        if (selectedWeight.includes('kg')) {\n          weightValue = parseFloat(selectedWeight.replace(/[^0-9.]/g, ''));\n        } else {\n          weightValue = parseFloat(selectedWeight.replace(/[^0-9.]/g, '')) / 1000; // Convert g to kg\n        }\n        finalPrice = Math.round(product.pricePerKg * weightValue);\n      }\n    }\n    \n    // Add customization modifiers\n    if (product.customization) {\n      product.customization.forEach(option => {\n        const selectedValue = customizations[option.type];\n        if (selectedValue && option.priceModifier && typeof option.priceModifier === 'object') {\n          finalPrice += option.priceModifier[selectedValue] || 0;\n        }\n      });\n    }\n\n    setCartItems(prevItems => {\n      const existingItemIndex = prevItems.findIndex(\n        item => (item.id === product.id || item._id === product._id) && \n        JSON.stringify(item.customizations) === JSON.stringify(customizations) &&\n        item.selectedWeight === selectedWeight\n      );\n\n      if (existingItemIndex > -1) {\n        // Update existing item\n        const updatedItems = [...prevItems];\n        updatedItems[existingItemIndex].quantity += quantity;\n        return updatedItems;\n      } else {\n        // Add new item\n        return [...prevItems, {\n          ...product,\n          id: product.id || product._id,\n          quantity,\n          customizations,\n          selectedWeight,\n          finalPrice,\n          cartId: `${product.id || product._id}_${Date.now()}_${Math.random()}`\n        }];\n      }\n    });\n    return true;\n  };\n\n  const removeFromCart = (cartId) => {\n    setCartItems(prevItems => prevItems.filter(item => item.cartId !== cartId));\n  };\n\n  const updateQuantity = (cartId, newQuantity) => {\n    if (newQuantity <= 0) {\n      removeFromCart(cartId);\n      return;\n    }\n\n    setCartItems(prevItems =>\n      prevItems.map(item =>\n        item.cartId === cartId ? { ...item, quantity: newQuantity } : item\n      )\n    );\n  };\n\n  const clearCart = async () => {\n    setCartItems([]);\n    localStorage.removeItem('stitch_savour_cart');\n    if (user) {\n      await cartService.clearCart();\n    }\n  };\n\n  const getCartTotal = () => {\n    return cartItems.reduce((total, item) => {\n      const itemPrice = item.finalPrice || item.price;\n      return total + (itemPrice * item.quantity);\n    }, 0);\n  };\n\n  const getTotalItems = () => {\n    return cartItems.reduce((total, item) => total + item.quantity, 0);\n  };\n\n  const getDeliveryTime = () => {\n    if (cartItems.length === 0) return 0;\n    return Math.max(...cartItems.map(item => item.deliveryTime || 2));\n  };\n\n  const value = {\n    cartItems,\n    addToCart,\n    removeFromCart,\n    updateQuantity,\n    clearCart,\n    getCartTotal,\n    getTotalItems,\n    getDeliveryTime\n  };\n\n  return (\n    <CartContext.Provider value={value}>\n      {children}\n    </CartContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}